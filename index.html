<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous Confessions | Share Your Truth, Stay Anonymous</title>
    <meta name="description" content="Share your anonymous confessions safely. Join thousands expressing themselves freely in our secure community.">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-color: #1f2937;
            --text-light: #6b7280;
            --bg-color: #0f0f23;
            --card-color: rgba(255, 255, 255, 0.1);
            --border-color: rgba(255, 255, 255, 0.2);
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
        }

        [data-theme="light"] {
            --text-color: #1f2937;
            --text-light: #6b7280;
            --bg-color: #f8fafc;
            --card-color: rgba(255, 255, 255, 0.8);
            --border-color: rgba(0, 0, 0, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #6366f1, #8b5cf6, #06b6d4, #10b981);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        [data-theme="light"] .bg-animation {
            background: linear-gradient(45deg, #f0f9ff, #f8fafc, #faf5ff, #f0fdf4);
            background-size: 400% 400%;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Floating Elements */
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .floating-bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
            backdrop-filter: blur(10px);
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }

        /* Glass Navigation */
        .navbar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 50px;
            padding: 15px 30px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .navbar:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-color);
        }

        .logo-container i {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 8px rgba(102, 126, 234, 0.3));
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .nav-link {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            padding: 8px 16px;
            border-radius: 20px;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .theme-toggle {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-color);
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(180deg);
        }

        .support-btn {
            background: linear-gradient(135deg, var(--warning-color), #e6951e);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .support-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        .karma-display {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 8px 16px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .karma-display:hover {
            transform: translateY(-1px);
            background: rgba(255, 215, 0, 0.1);
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 0 20px;
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            max-width: 800px;
            z-index: 2;
        }

        .hero h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 800;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color), var(--success-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: textGlow 3s ease-in-out infinite alternate;
            line-height: 1.1;
        }

        @keyframes textGlow {
            0% { filter: drop-shadow(0 0 20px rgba(102, 126, 234, 0.3)); }
            100% { filter: drop-shadow(0 0 30px rgba(102, 126, 234, 0.6)); }
        }

        .hero-subtitle {
            font-size: 1.5rem;
            color: var(--text-light);
            margin-bottom: 40px;
            font-weight: 300;
            opacity: 0;
            animation: fadeInUp 1s ease 0.5s forwards;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 50px;
            opacity: 0;
            animation: fadeInUp 1s ease 1s forwards;
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-color);
            display: block;
            animation: countUp 2s ease 1.5s forwards;
        }

        .hero-stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            opacity: 0;
            animation: fadeInUp 1s ease 1.5s forwards;
        }

        .cta-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .cta-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .cta-primary:hover::before {
            left: 100%;
        }

        .cta-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .cta-secondary {
            background: var(--glass-bg);
            color: var(--text-color);
            border: 1px solid var(--glass-border);
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cta-secondary:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        /* Live Activity Feed */
        .live-activity {
            position: fixed;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 20px;
            width: 300px;
            z-index: 100;
            opacity: 0;
            animation: slideInRight 1s ease 2s forwards;
        }

        .activity-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--text-color);
            font-weight: 600;
        }

        .activity-pulse {
            width: 8px;
            height: 8px;
            background: var(--success-color);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        .activity-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            color: var(--text-light);
            animation: fadeIn 0.5s ease;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        /* Categories Showcase */
        .categories-section {
            padding: 100px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            text-align: center;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 60px;
            color: var(--text-color);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .category-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .category-card:hover::before {
            opacity: 0.1;
        }

        .category-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .category-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .category-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .category-desc {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Confession Form */
        .confession-form {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 40px;
            max-width: 800px;
            margin: 50px auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .form-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-color);
        }

        .confession-textarea {
            width: 100%;
            min-height: 150px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            font-family: inherit;
            font-size: 1rem;
            color: var(--text-color);
            resize: vertical;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .confession-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
        }

        .confession-textarea::placeholder {
            color: var(--text-light);
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px) translateY(-50%);
            }
            to {
                opacity: 1;
                transform: translateX(0) translateY(-50%);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes countUp {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Welcome Modal */
        .welcome-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .welcome-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .welcome-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 50px;
            max-width: 500px;
            text-align: center;
            color: var(--text-color);
            animation: modalSlideIn 0.5s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .welcome-text {
            color: var(--text-light);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .welcome-button {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .welcome-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 100px;
            right: 30px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            z-index: 2000;
            transform: translateX(400px);
            transition: all 0.3s ease;
            min-width: 300px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid var(--success-color);
        }

        .toast-error {
            border-left: 4px solid var(--danger-color);
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .navbar {
                top: 10px;
                left: 10px;
                right: 10px;
                transform: none;
                padding: 10px 20px;
                flex-wrap: wrap;
                gap: 15px;
            }

            .nav-links {
                gap: 15px;
            }

            .hero h1 {
                font-size: 3rem;
            }

            .hero-stats {
                flex-direction: column;
                gap: 20px;
            }

            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }

            .live-activity {
                display: none;
            }

            .categories-grid {
                grid-template-columns: 1fr;
            }

            .confession-form {
                margin: 20px;
                padding: 30px 20px;
            }
        }

        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, var(--glass-bg) 25%, rgba(255, 255, 255, 0.1) 50%, var(--glass-bg) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation"></div>
    
    <!-- Floating Elements -->
    <div class="floating-elements" id="floatingElements"></div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo-container">
            <i class="fas fa-mask"></i>
            <span>Confessions</span>
        </div>
        <div class="nav-links">
            <a href="#" class="nav-link">Home</a>
            <a href="#" class="nav-link">About</a>
            <a href="#" class="nav-link">Rules</a>
            <a href="#" class="nav-link">Local</a>
            <button class="support-btn">
                <i class="fas fa-heart"></i>
                Support
            </button>
            <div class="karma-display">
                <i class="fas fa-star"></i>
                <span id="karma-count">460</span> Karma
            </div>
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Share Your Truth.<br>Stay Anonymous.</h1>
            <p class="hero-subtitle">
                Join thousands expressing themselves freely in our secure, judgment-free community
            </p>
            <div class="hero-stats">
                <div class="hero-stat">
                    <span class="hero-stat-number" data-target="12847">0</span>
                    <span class="hero-stat-label">Confessions Shared</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-number" data-target="156">0</span>
                    <span class="hero-stat-label">Today</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-number" data-target="8932">0</span>
                    <span class="hero-stat-label">Community Members</span>
                </div>
            </div>
            <div class="cta-buttons">
                <button class="cta-primary" onclick="showConfessionForm()">
                    <i class="fas fa-edit"></i>
                    Share Your Story
                </button>
                <button class="cta-secondary" onclick="exploreConfessions()">
                    <i class="fas fa-compass"></i>
                    Explore Confessions
                </button>
            </div>
        </div>
    </section>

    <!-- Live Activity Feed -->
    <div class="live-activity">
        <div class="activity-header">
            <div class="activity-pulse"></div>
            <span>Live Activity</span>
        </div>
        <div id="activity-feed">
            <div class="activity-item">Anonymous shared in Trading category</div>
            <div class="activity-item">Someone just earned their first badge</div>
            <div class="activity-item">New confession in Crypto category</div>
            <div class="activity-item">Community reached 13K confessions!</div>
        </div>
    </div>

    <!-- Categories Section -->
    <section class="categories-section">
        <h2 class="section-title">Choose Your Category</h2>
        <div class="categories-grid">
            <div class="category-card" data-category="alpha">
                <div class="category-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <h3 class="category-title">Alpha</h3>
                <p class="category-desc">Share your winning moves and success stories</p>
            </div>
            <div class="category-card" data-category="rekt">
                <div class="category-icon">
                    <i class="fas fa-chart-line-down"></i>
                </div>
                <h3 class="category-title">Rekt Stories</h3>
                <p class="category-desc">Learn from losses and epic fails</p>
            </div>
            <div class="category-card" data-category="gains">
                <div class="category-icon">
                    <i class="fas fa-rocket"></i>
                </div>
                <h3 class="category-title">Gains</h3>
                <p class="category-desc">Celebrate your financial victories</p>
            </div>
            <div class="category-card" data-category="trading">
                <div class="category-icon">
                    <i class="fas fa-chart-candlestick"></i>
                </div>
                <h3 class="category-title">Trading</h3>
                <p class="category-desc">Trading strategies and market insights</p>
            </div>
            <div class="category-card" data-category="shill">
                <div class="category-icon">
                    <i class="fas fa-bullhorn"></i>
                </div>
                <h3 class="category-title">Shill</h3>
                <p class="category-desc">Share your favorite projects (responsibly)</p>
            </div>
            <div class="category-card" data-category="meme">
                <div class="category-icon">
                    <i class="fas fa-laugh"></i>
                </div>
                <h3 class="category-title">Meme</h3>
                <p class="category-desc">Funny stories and crypto humor</p>
            </div>
        </div>
    </section>

    <!-- Confession Form (Hidden by default) -->
    <div class="confession-form" id="confession-form" style="display: none;">
        <h2 class="form-title">Share Your Anonymous Confession</h2>
        <textarea class="confession-textarea" placeholder="What's on your mind? Share your story anonymously..." id="confession-text"></textarea>
        <div style="text-align: center; margin-top: 30px;">
<button class="cta-primary" type="submit">
               <i class="fas fa-paper-plane"></i>
               Submit Confession
           </button>
       </div>
   </div>

   <!-- Floating Action Button -->
   <button class="fab" onclick="showConfessionForm()">
       <i class="fas fa-plus"></i>
   </button>

   <!-- Welcome Modal -->
   <div class="welcome-modal active" id="welcome-modal">
       <div class="welcome-content">
           <div class="welcome-icon">
               <i class="fas fa-mask"></i>
           </div>
           <h2 class="welcome-title">Welcome to Anonymous Confessions</h2>
           <p class="welcome-text">
               This is a safe space where you can share your thoughts, experiences, and confessions completely anonymously. 
               Your privacy is our priority.
           </p>
           <button class="welcome-button" onclick="closeWelcomeModal()">
               Get Started
           </button>
       </div>
   </div>

   <!-- Toast Notification -->
   <div class="toast" id="toast">
       <div class="toast-content">
           <i class="fas fa-check-circle"></i>
           <span id="toast-message">Confession submitted successfully!</span>
       </div>
   </div>

   <!-- Recent Confessions Section -->
   <section class="categories-section">
       <h2 class="section-title">Recent Confessions</h2>
       
       <!-- Search and Filters -->
       <div style="max-width: 800px; margin: 0 auto 40px auto;">
           <div style="position: relative; margin-bottom: 20px;">
               <input type="text" placeholder="Search confessions..." id="search-input"
                      style="width: 100%; padding: 15px 50px 15px 20px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 50px; color: var(--text-color); backdrop-filter: blur(20px);">
               <i class="fas fa-search" style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: var(--text-light);"></i>
           </div>
           
           <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
               <select id="sort-select" style="padding: 10px 20px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 25px; color: var(--text-color); backdrop-filter: blur(20px);">
                   <option value="newest">Newest First</option>
                   <option value="oldest">Oldest First</option>
                   <option value="popular">Most Popular</option>
               </select>
               <select id="category-filter" style="padding: 10px 20px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 25px; color: var(--text-color); backdrop-filter: blur(20px);">
                   <option value="all">All Categories</option>
                   <option value="alpha">Alpha</option>
                   <option value="rekt">Rekt Story</option>
                   <option value="gains">Gains</option>
                   <option value="trading">Trading</option>
                   <option value="shill">Shill</option>
                   <option value="meme">Meme</option>
               </select>
           </div>
       </div>

       <!-- Confessions List -->
       <div id="confessions-list" style="max-width: 800px; margin: 0 auto;">
           <!-- Loading skeleton -->
           <div class="skeleton" style="height: 200px; border-radius: 20px; margin-bottom: 20px;"></div>
           <div class="skeleton" style="height: 200px; border-radius: 20px; margin-bottom: 20px;"></div>
           <div class="skeleton" style="height: 200px; border-radius: 20px;"></div>
       </div>
       
       <!-- Pagination -->
       <div id="pagination" style="display: flex; justify-content: center; gap: 10px; margin-top: 40px;"></div>
   </section>

   <!-- Success/Error Messages -->
   <div id="success-message" style="display: none; background: var(--success-color); color: white; padding: 15px; border-radius: 8px; margin: 20px auto; max-width: 800px; text-align: center;">
       <i class="fas fa-check-circle"></i>
       <span>Your confession has been submitted successfully!</span>
   </div>

   <div id="error-message" style="display: none; background: var(--danger-color); color: white; padding: 15px; border-radius: 8px; margin: 20px auto; max-width: 800px; text-align: center;">
       <i class="fas fa-exclamation-circle"></i>
       <span id="error-text">An error occurred. Please try again.</span>
   </div>

   <!-- Donation Modal -->
   <div id="donation-modal" class="donation-modal">
       <div class="donation-modal-content">
           <span class="close" onclick="closeDonationModal()">&times;</span>
           <div class="donation-header">
               <h2 class="donation-title">Support Our Community</h2>
               <p class="donation-subtitle">Your support helps maintain this safe space for anonymous confessions</p>
           </div>
           
           <div class="donation-amounts">
               <button class="amount-btn" data-amount="5">$5</button>
               <button class="amount-btn" data-amount="10">$10</button>
               <button class="amount-btn" data-amount="25">$25</button>
               <button class="amount-btn" data-amount="50">$50</button>
               <button class="amount-btn" data-amount="100">$100</button>
               <button class="amount-btn" data-amount="custom">Custom</button>
           </div>
           
           <div class="custom-amount-container" id="custom-amount-container" style="display: none;">
               <input type="number" class="custom-amount-input" id="custom-amount-input" placeholder="Enter amount in USD" min="1">
           </div>
           
           <div class="payment-options">
               <div class="payment-method" data-method="bitcoin">
                   <i class="fab fa-bitcoin"></i>
                   <div class="payment-info">
                       <div class="payment-name">Bitcoin</div>
                       <div class="payment-desc">BTC payments</div>
                   </div>
               </div>
               <div class="payment-method" data-method="ethereum">
                   <i class="fab fa-ethereum"></i>
                   <div class="payment-info">
                       <div class="payment-name">Ethereum</div>
                       <div class="payment-desc">ETH payments</div>
                   </div>
               </div>
               <div class="payment-method" data-method="lightning">
                   <i class="fas fa-bolt"></i>
                   <div class="payment-info">
                       <div class="payment-name">Lightning Network</div>
                       <div class="payment-desc">Fast BTC payments</div>
                   </div>
               </div>
           </div>
           <div class="donation-address" id="donation-address"></div>
           
           <div class="charity-section">
               <label class="charity-checkbox">
                   <input type="checkbox" id="charity-donation">
                   Donate 10% to charity
               </label>
               <select class="charity-dropdown" id="charity-select">
                   <option value="">Select charity</option>
                   <option value="mental-health">Mental Health Foundation</option>
                   <option value="privacy-rights">Electronic Frontier Foundation</option>
                   <option value="free-speech">Freedom of Press Foundation</option>
               </select>
           </div>
           
           <button class="donate-submit-btn" id="donate-submit-btn" disabled>
               Proceed to Payment
           </button>
       </div>
   </div>

   <!-- Leaderboard Modal -->
   <div id="leaderboard-modal" class="modal">
       <div class="modal-content">
           <span class="close">&times;</span>
           <h2><i class="fas fa-trophy"></i> Top Contributors</h2>
           <div id="leaderboard-content">
               <div class="loading">
                   <i class="fas fa-spinner"></i>
               </div>
           </div>
       </div>
   </div>

   <!-- Share Card Modal -->
   <div id="share-card-modal" class="modal">
       <div class="modal-content">
           <span class="close" onclick="closeShareCardModal()">&times;</span>
           <h2><i class="fas fa-image"></i> Share Card Preview</h2>
           <div id="share-card-preview"></div>
           <div style="text-align: center; margin-top: 20px;">
               <button onclick="downloadShareCard()" style="background-color: var(--success-color); margin-right: 10px;">
                   <i class="fas fa-download"></i> Download Card
               </button>
               <button onclick="closeShareCardModal()" style="background-color: var(--text-light);">
                   <i class="fas fa-times"></i> Cancel
               </button>
           </div>
       </div>
   </div>

   <!-- Achievement Popup -->
   <div id="achievement-popup" class="achievement-popup">
       <h4 id="achievement-title"></h4>
       <p id="achievement-description"></p>
   </div>

   <!-- Share Card Canvas (hidden) -->
   <div id="share-card-canvas" style="position: absolute; left: -9999px; top: -9999px;">
       <div class="share-card" style="width: 600px; background: white;">
           <div class="share-card-header">
               <div class="share-card-logo">
                   <i class="fas fa-feather-alt"></i>
                   <span>Anonymous Confessions</span>
               </div>
               <div id="share-card-date"></div>
           </div>
           <div class="share-card-content" id="share-card-text"></div>
           <div class="share-card-footer">
               <div id="share-card-stats"></div>
               <div id="share-card-qr" class="qr-code"></div>
           </div>
       </div>
   </div>

   <!-- Connection Status -->
   <div id="connection-status" class="connection-status status-connecting">
       <i class="fas fa-circle-notch fa-spin"></i>
       <span>Connecting...</span>
   </div>

   <!-- Firebase SDK -->
   <script type="module">
       import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
       import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
       import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, query, orderBy, limit, where, serverTimestamp, increment, arrayUnion, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
       
       const firebaseConfig = {
           apiKey: "AIzaSyADTUf0vuhZXm2rnNLoXC9fjxAtMtiTSnA",
           authDomain: "confessions-121bc.firebaseapp.com",
           projectId: "confessions-121bc",
           storageBucket: "confessions-121bc.firebasestorage.app",
           messagingSenderId: "339849633893",
           appId: "1:339849633893:web:a5a739b760e9a3ec77e68c",
           measurementId: "G-8755436E5W"
       };

       const app = initializeApp(firebaseConfig);
       const analytics = getAnalytics(app);
       const db = getFirestore(app);

       window.firebaseServices = {
           db,
           collection,
           addDoc,
           getDocs,
           doc,
           updateDoc,
           deleteDoc,
           query,
           orderBy,
           limit,
           where,
           serverTimestamp,
           increment,
           arrayUnion,
           getDoc,
           setDoc
       };
       
       console.log("Firebase SDK loaded successfully");
   </script>

   <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

   <script>
       // Configuration
       const CONFESSIONS_PER_PAGE = 10;
       const MAX_CONFESSION_LENGTH = 1000;
       const AUTO_ARCHIVE_DAYS = 30;
       const FORBIDDEN_WORDS = ['hate', 'kill', 'racist', 'sexist'];
       
       // Firebase Configuration
       const FIREBASE_SETTINGS = {
           collection: 'anonymous-confessions',
           userCollection: 'users',
           donationCollection: 'donations',
           fundingCollection: 'funding',
           limit: 100
       };
       
       // Donation Configuration
       const DONATION_ADDRESSES = {
           bitcoin: '1YourBitcoinAddressHere',
           ethereum: '0xYourEthereumAddressHere',
           lightning: 'lightning:YourLightningAddressHere'
       };
       
       const FUNDING_GOALS = {
           server: { target: 500, current: 0 },
           feature: { target: 2000, current: 0 },
           charity: { target: 10000, current: 0 }
       };

       // Karma & Achievement System Configuration
       const KARMA_POINTS = {
           submitConfession: 10,
           receiveReaction: 1,
           receiveReply: 2,
           receiveLove: 3,
           dailyConfession: 5,
           popularConfession: 20,
           donateSmall: 50,
           donateMedium: 100,
           donateLarge: 250,
           donateCharity: 500,
           globalContribution: 50
       };

       const ACHIEVEMENTS = {
           firstConfession: {
               id: 'first_confession',
               title: 'First Steps',
               description: 'Submit your first confession',
               karma: 50
           },
           popularConfession: {
               id: 'popular_confession',
               title: 'Crowd Favorite',
               description: 'Get 50+ reactions on a confession',
               karma: 100
           },
           dailyStreak: {
               id: 'daily_streak',
               title: 'Regular Contributor',
               description: 'Submit confessions 7 days in a row',
               karma: 200
           },
           conversationStarter: {
               id: 'conversation_starter',
               title: 'Conversation Starter',
               description: 'Get 10+ replies on a confession',
               karma: 150
           },
           karmaLegend: {
               id: 'karma_legend',
               title: 'Karma Legend',
               description: 'Reach 1000 karma points',
               karma: 500
           },
           supporter: {
               id: 'supporter',
               title: 'Community Supporter',
               description: 'Make your first donation',
               karma: 100
           },
           philanthropist: {
               id: 'philanthropist',
               title: 'Philanthropist',
               description: 'Donate to charity',
               karma: 1000
           },
           cryptoWhale: {
               id: 'crypto_whale',
               title: 'Crypto Whale',
               description: 'Donate over $100',
               karma: 500
           },
           globalContributor: {
               id: 'global_contributor',
               title: 'Global Contributor',
               description: 'Share your first confession globally',
               karma: 100
           }
       };

       // Crypto-specific achievements
       const CRYPTO_ACHIEVEMENTS = {
           diamondHands: {
               id: 'diamond_hands',
               title: 'Diamond Hands',
               description: 'Mention holding through a 50%+ dip',
               karma: 150,
               icon: 'fas fa-gem'
           },
           paperHands: {
               id: 'paper_hands',
               title: 'Paper Hands',
               description: 'Confess to selling too early',
               karma: 50,
               icon: 'fas fa-scroll'
           },
           earlyApe: {
               id: 'early_ape',
               title: 'Early Ape',
               description: 'Got in before 100 holders',
               karma: 300,
               icon: 'fas fa-rocket'
           },
           whale: {
               id: 'whale',
               title: 'Crypto Whale',
               description: 'Donate over 0.1 ETH equivalent',
               karma: 500,
               icon: 'fas fa-whale'
           },
           degen: {
               id: 'degen',
               title: 'Certified Degen',
               description: 'Post 10+ confessions in the "ape" category',
               karma: 200,
               icon: 'fas fa-fire'
           }
       };

       // State management
       let currentPage = 1;
       let currentCategory = 'all';
       let currentSort = 'newest';
       let searchQuery = '';
       let selectedCategory = null;
       let isSubmitting = false;
       let userKarma = 0;
       let userAchievements = [];
       let userId = null;
       let selectedDonationAmount = null;
       let selectedPaymentMethod = null;
       let donations = [];
       let userDonations = [];
       let currentTipConfessionId = null;
       let isGlobalMode = true;
       let firebaseInitialized = false;
       let autoRefreshInterval = null;
       let lastRefreshTime = null;

       // Enhanced UI Functions
       function createFloatingBubbles() {
           const container = document.getElementById('floatingElements');
           
           setInterval(() => {
               const bubble = document.createElement('div');
               bubble.className = 'floating-bubble';
               
               const size = Math.random() * 60 + 20;
               bubble.style.width = size + 'px';
               bubble.style.height = size + 'px';
               bubble.style.left = Math.random() * window.innerWidth + 'px';
               bubble.style.animationDuration = (Math.random() * 10 + 15) + 's';
               bubble.style.animationDelay = Math.random() * 2 + 's';
               
               container.appendChild(bubble);
               
               setTimeout(() => {
                   if (bubble.parentNode) {
                       bubble.parentNode.removeChild(bubble);
                   }
               }, 25000);
           }, 3000);
       }

       function animateCounter(element, target) {
           const start = 0;
           const duration = 2000;
           const startTime = performance.now();
           
           function update(currentTime) {
               const elapsed = currentTime - startTime;
               const progress = Math.min(elapsed / duration, 1);
               const current = Math.floor(progress * target);
               
               element.textContent = current.toLocaleString();
               
               if (progress < 1) {
                   requestAnimationFrame(update);
               }
           }
           
           requestAnimationFrame(update);
       }

       function updateLiveActivity() {
           const activities = [
               "Anonymous shared in Trading category",
               "Someone just earned their first badge",
               "New confession in Crypto category", 
               "Community reached 13K confessions!",
               "Anonymous received 50+ reactions",
               "New member joined the community",
               "Someone shared their first confession",
               "Anonymous earned Diamond Hands badge"
           ];
           
           const feed = document.getElementById('activity-feed');
           if (!feed) return;
           
           setInterval(() => {
               const randomActivity = activities[Math.floor(Math.random() * activities.length)];
               const newItem = document.createElement('div');
               newItem.className = 'activity-item';
               newItem.textContent = randomActivity;
               newItem.style.opacity = '0';
               
               feed.insertBefore(newItem, feed.firstChild);
               
               setTimeout(() => {
                   newItem.style.opacity = '1';
               }, 100);
               
               if (feed.children.length > 4) {
                   feed.removeChild(feed.lastChild);
               }
           }, 5000);
       }

       function showToast(message, type = 'success') {
           const toast = document.getElementById('toast');
           const toastMessage = document.getElementById('toast-message');
           const icon = toast.querySelector('i');
           
           toastMessage.textContent = message;
           toast.className = `toast toast-${type} show`;
           
           if (type === 'success') {
               icon.className = 'fas fa-check-circle';
           } else if (type === 'error') {
               icon.className = 'fas fa-exclamation-circle';
           }
           
           setTimeout(() => {
               toast.classList.remove('show');
           }, 4000);
       }

       function showConfessionForm() {
           const form = document.getElementById('confession-form');
           if (form) {
               form.style.display = 'block';
               form.scrollIntoView({ behavior: 'smooth' });
               const textarea = document.getElementById('confession-text');
               if (textarea) textarea.focus();
           }
       }

       function exploreConfessions() {
           const section = document.querySelector('.categories-section');
           if (section) {
               section.scrollIntoView({ behavior: 'smooth' });
           }
       }

       function closeWelcomeModal() {
           const modal = document.getElementById('welcome-modal');
           if (modal) {
               modal.classList.remove('active');
               localStorage.setItem('welcomeShown', 'true');
           }
       }

       function toggleTheme() {
           const html = document.documentElement;
           const currentTheme = html.getAttribute('data-theme');
           const newTheme = currentTheme === 'light' ? 'dark' : 'light';
           
           html.setAttribute('data-theme', newTheme);
           localStorage.setItem('theme', newTheme);
           
           const icon = document.querySelector('#theme-toggle i');
           if (icon) {
               icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
           }
       }

       // Initialize Firebase when the script loads
       let initFirebaseInterval;
       function checkFirebaseLoaded() {
           if (window.firebaseServices) {
               clearInterval(initFirebaseInterval);
               initializeFirebase();
           }
       }
       initFirebaseInterval = setInterval(checkFirebaseLoaded, 100);

       // Initialize Firebase
       function initializeFirebase() {
           try {
               console.log("Initializing Firebase...");
               const savedSettings = localStorage.getItem('firebaseSettings');
               if (savedSettings) {
                   Object.assign(FIREBASE_SETTINGS, JSON.parse(savedSettings));
               }
               
               updateConnectionStatus('connecting');
               
               if (!window.firebaseServices || !window.firebaseServices.db || !window.firebaseServices.collection) {
                   console.error("Firebase SDK not properly loaded");
                   updateConnectionStatus('offline');
                   return;
               }
               
               if (navigator.onLine) {
                   firebaseInitialized = true;
                   updateConnectionStatus('online');
                   console.log("Firebase initialized successfully");
                   
                   testFirebaseConnection();
                   
                   if (isGlobalMode) {
                       loadGlobalConfessions();
                       startAutoRefresh();
                   }
               } else {
                   console.error("Browser is offline");
                   updateConnectionStatus('offline');
               }
               
               window.addEventListener('online', () => {
                   console.log("Browser went online");
                   updateConnectionStatus('online');
                   if (isGlobalMode) {
                       loadGlobalConfessions();
                       startAutoRefresh();
                   }
               });
               
               window.addEventListener('offline', () => {
                   console.log("Browser went offline");
                   updateConnectionStatus('offline');
                   stopAutoRefresh();
               });
           } catch (error) {
               console.error("Firebase initialization error:", error);
               updateConnectionStatus('offline');
           }
       }

       // Test Firebase connection
       async function testFirebaseConnection() {
           console.log("Testing Firebase connection...");
           try {
               if (!window.firebaseServices) {
                   throw new Error('Firebase services not available');
               }
               
               const { db, collection, getDocs, query, limit } = window.firebaseServices;
               
               const testQuery = query(collection(db, FIREBASE_SETTINGS.collection), limit(1));
               
               getDocs(testQuery)
                   .then((snapshot) => {
                       console.log(`Firebase connection successful. Found ${snapshot.size} documents.`);
                       
                       if (snapshot.size === 0) {
                           createFirstConfession();
                       }
                       
                       return true;
                   })
                   .catch((error) => {
                       console.error("Firebase connection test failed:", error);
                       return false;
                   });
           } catch (error) {
               console.error("Firebase test error:", error);
               return false;
           }
       }

       // Create the first confession to initialize the collection
       async function createFirstConfession() {
           try {
               console.log("Creating first confession to initialize collection");
               if (!window.firebaseServices) {
                   throw new Error('Firebase services not available');
               }
               
               const { db, collection, addDoc, serverTimestamp } = window.firebaseServices;
               
               const firstConfession = {
                   text: "Welcome to Anonymous Confessions! This is the first confession.",
                   userId: "system",
                   timestamp: new Date().toISOString(),
                   serverTimestamp: serverTimestamp(),
                   views: 0,
                   reactions: {
                       like: 0,
                       dislike: 0,
                       love: 0,
                       haha: 0,
                       wow: 0,
                       sad: 0
                   },
                   replies: [],
                   reports: 0,
                   reported: false,
                   tips: 0,
                   donors: [],
                   popularity: 0,
                   isGlobal: true,
                   category: null
               };
               
               const docRef = await addDoc(collection(db, FIREBASE_SETTINGS.collection), firstConfession);
               console.log("First confession created with ID:", docRef.id);
               
               return true;
           } catch (error) {
               console.error("Error creating first confession:", error);
               return false;
           }
       }

       // Update the connection status indicator
       function updateConnectionStatus(status) {
           const statusElement = document.getElementById('connection-status');
           if (!statusElement) return;
           
           statusElement.className = 'connection-status';
           
           if (status === 'online') {
               statusElement.classList.add('status-online');
               statusElement.innerHTML = '<i class="fas fa-wifi"></i><span>Online (Global)</span>';
               setTimeout(() => {
                   statusElement.style.opacity = '0.7';
               }, 3000);
           } else if (status === 'offline') {
               statusElement.classList.add('status-offline');
               statusElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Offline (Local Only)</span>';
           } else {
               statusElement.classList.add('status-connecting');
               statusElement.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i><span>Connecting...</span>';
           }
       }

       // Generate consistent anonymous identities
       function generateAnonIdentity(userId) {
           let hash = 0;
           for (let i = 0; i < userId.length; i++) {
               hash = ((hash << 5) - hash) + userId.charCodeAt(i);
               hash |= 0;
           }
           
           const adjectives = ['Based', 'Bullish', 'Bearish', 'Diamond', 'Paper', 'Degen', 'Anon', 'Crypto', 'Moon', 'Whale', 'Ape'];
           const nouns = ['Trader', 'Holder', 'Ape', 'Degen', 'Wallet', 'Bull', 'Bear', 'Shrimp', 'Whale', 'Dolphin'];
           
           const adjIndex = Math.abs(hash) % adjectives.length;
           const nounIndex = Math.abs(hash >> 8) % nouns.length;
           const number = Math.abs(hash) % 1000;
           
           return `${adjectives[adjIndex]}${nouns[nounIndex]}${number}`;
       }

       // Auto-refresh functionality
       function startAutoRefresh() {
           if (autoRefreshInterval) return;
           
           console.log("Starting auto-refresh for global confessions");
           lastRefreshTime = new Date();
           
           autoRefreshInterval = setInterval(() => {
               if (isGlobalMode && firebaseInitialized && navigator.onLine) {
                   checkForNewConfessions();
               }
           }, 30000);
       }

       function stopAutoRefresh() {
           if (autoRefreshInterval) {
               console.log("Stopping auto-refresh");
               clearInterval(autoRefreshInterval);
               autoRefreshInterval = null;
           }
       }

       // Check for new confessions since last refresh
       async function checkForNewConfessions() {
           try {
               if (!window.firebaseServices || !lastRefreshTime) return;
               
               const { db, collection, getDocs, query, where, orderBy } = window.firebaseServices;
               
               const confessionsRef = collection(db, FIREBASE_SETTINGS.collection);
               
               const newConfessionsQuery = query(
                   confessionsRef,
                   where('timestamp', '>', lastRefreshTime.toISOString()),
                   orderBy('timestamp', 'desc')
               );
               
               const querySnapshot = await getDocs(newConfessionsQuery);
               
               if (!querySnapshot.empty) {
                   console.log(`Found ${querySnapshot.size} new confession(s)`);
                   
                   showNewConfessionsNotification(querySnapshot.size);
                   
                   if (currentPage === 1 && currentSort === 'newest' && currentCategory === 'all' && !searchQuery) {
                       loadGlobalConfessions();
                   }
               }
               
               lastRefreshTime = new Date();
           } catch (error) {
               console.error("Error checking for new confessions:", error);
           }
       }

       // Show notification about new confessions
       function showNewConfessionsNotification(count) {
           const notification = document.createElement('div');
           notification.className = 'new-confessions-notification';
           notification.style.cssText = `
               position: fixed;
               top: 80px;
               right: 20px;
               background: var(--primary-color);
               color: white;
               padding: 12px 20px;
               border-radius: 8px;
box-shadow: 0 4px 12px rgba(0,0,0,0.15);
               z-index: 1000;
               cursor: pointer;
               animation: slideIn 0.3s ease-out;
               display: flex;
               align-items: center;
               gap: 8px;
               font-size: 0.9rem;
               font-weight: 500;
           `;
           
           notification.innerHTML = `
               <i class="fas fa-bell"></i>
               <span>${count} new confession${count > 1 ? 's' : ''}</span>
               <i class="fas fa-times" style="margin-left: 10px; opacity: 0.7; cursor: pointer;" onclick="event.stopPropagation(); this.closest('.new-confessions-notification').remove();"></i>
           `;
           
           notification.onclick = () => {
               if (currentPage !== 1 || currentSort !== 'newest' || currentCategory !== 'all' || searchQuery) {
                   currentPage = 1;
                   currentSort = 'newest';
                   currentCategory = 'all';
                   searchQuery = '';
                   
                   document.getElementById('sort-select').value = 'newest';
                   document.getElementById('category-filter').value = 'all';
                   document.getElementById('search-input').value = '';
               }
               
               loadGlobalConfessions();
               window.scrollTo({ top: 0, behavior: 'smooth' });
               notification.remove();
           };
           
           document.body.appendChild(notification);
           
           setTimeout(() => {
               if (notification.parentNode) {
                   notification.remove();
               }
           }, 10000);
       }

       // Toggle between local and global mode
       function toggleGlobalMode(force) {
           const newGlobalMode = typeof force !== 'undefined' ? force : !isGlobalMode;
           
           if (newGlobalMode && (!firebaseInitialized || !navigator.onLine)) {
               showErrorMessage('Firebase is not available. Please check your connection and try again.');
               return;
           }
           
           isGlobalMode = newGlobalMode;
           localStorage.setItem('globalMode', isGlobalMode);
           
           const globalLink = document.getElementById('global-link');
           if (globalLink) {
               if (isGlobalMode) {
                   globalLink.innerHTML = 'Local';
                   loadGlobalConfessions();
                   startAutoRefresh();
               } else {
                   globalLink.innerHTML = 'Global';
                   loadConfessions();
                   stopAutoRefresh();
               }
           }
           
           currentPage = 1;
           showSuccessMessage(isGlobalMode ? 'Switched to global mode' : 'Switched to local mode');
       }

       // Load confessions from Firebase
       async function loadGlobalConfessions() {
           try {
               console.log("Loading global confessions...");
               const confessionsContainer = document.getElementById('confessions-list');
               confessionsContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i></div>';
               
               if (!window.firebaseServices) {
                   console.error("Firebase services are not available");
                   showErrorMessage('Firebase services are not available');
                   return;
               }
               
               const { db, collection, getDocs, query, orderBy, limit, where } = window.firebaseServices;
               
               const confessionsRef = collection(db, FIREBASE_SETTINGS.collection);
               console.log("Collection reference created for:", FIREBASE_SETTINGS.collection);
               
               let firestoreQuery;
               
               try {
                   if (currentCategory !== 'all') {
                       firestoreQuery = query(
                           confessionsRef,
                           where('category', '==', currentCategory),
                           orderBy('timestamp', currentSort === 'oldest' ? 'asc' : 'desc'),
                           limit(FIREBASE_SETTINGS.limit)
                       );
                   } else {
                       if (currentSort === 'popular') {
                           firestoreQuery = query(
                               confessionsRef,
                               orderBy('popularity', 'desc'),
                               limit(FIREBASE_SETTINGS.limit)
                           );
                       } else {
                           firestoreQuery = query(
                               confessionsRef,
                               orderBy('timestamp', currentSort === 'oldest' ? 'asc' : 'desc'),
                               limit(FIREBASE_SETTINGS.limit)
                           );
                       }
                   }
                   console.log("Query built successfully");
                   
                   console.log("Executing Firestore query...");
                   const querySnapshot = await getDocs(firestoreQuery);
                   console.log("Query executed, processing results...");
                   
                   let confessions = [];
                   querySnapshot.forEach((doc) => {
                       console.log("Processing document:", doc.id);
                       const confession = {
                           id: doc.id,
                           ...doc.data()
                       };
                       confessions.push(confession);
                   });
                   
                   console.log(`Found ${confessions.length} confessions`);
                   
                   if (searchQuery) {
                       const query = searchQuery.toLowerCase();
                       confessions = confessions.filter(c => c.text.toLowerCase().includes(query));
                   }
                   
                   displayConfessions(confessions);
                   
                   if (confessions.length === 0) {
                       console.log("No confessions found, creating the first one");
                       await createFirstConfession();
                       loadGlobalConfessions();
                   }
               } catch (error) {
                   console.error("Error in query execution:", error);
                   throw error;
               }
           } catch (error) {
               console.error("Error loading global confessions:", error);
               showErrorMessage('Error loading global confessions. Check your connection.');
               confessionsContainer.innerHTML = `<div class="no-confessions"><i class="fas fa-exclamation-circle"></i>Error loading global confessions: ${error.message}</div>`;
           }
       }

       // Load local confessions
       function loadConfessions() {
           try {
               const confessionsContainer = document.getElementById('confessions-list');
               let confessions = JSON.parse(localStorage.getItem('confessions')) || [];
               
               confessions = applyFilters(confessions);
               
               const totalPages = Math.ceil(confessions.length / CONFESSIONS_PER_PAGE);
               const start = (currentPage - 1) * CONFESSIONS_PER_PAGE;
               const end = start + CONFESSIONS_PER_PAGE;
               const pageConfessions = confessions.slice(start, end);
               
               displayConfessions(pageConfessions, totalPages);
           } catch (error) {
               console.error("Error in loadConfessions:", error);
               document.getElementById('confessions-list').innerHTML = '<div class="error">Error loading confessions. Please refresh the page.</div>';
           }
       }

       function displayConfessions(confessions, totalPages) {
           const confessionsContainer = document.getElementById('confessions-list');
           
           if (confessions.length === 0) {
               confessionsContainer.innerHTML = '<div class="no-confessions"><i class="fas fa-feather"></i>No confessions found. Be the first to share!</div>';
               document.getElementById('pagination').innerHTML = '';
               return;
           }
           
           confessionsContainer.innerHTML = '';
           
           confessions.forEach(confession => {
               const confessionElement = createConfessionElement(confession);
               confessionsContainer.appendChild(confessionElement);
               incrementViewCount(confession.id);
           });
           
           if (totalPages) {
               createPagination(totalPages);
           }
       }

       function applyFilters(confessions) {
           let filtered = [...confessions];
           
           if (currentCategory !== 'all') {
               filtered = filtered.filter(c => c.category === currentCategory);
           }
           
           if (searchQuery) {
               const query = searchQuery.toLowerCase();
               filtered = filtered.filter(c => c.text.toLowerCase().includes(query));
           }
           
           switch (currentSort) {
               case 'oldest':
                   filtered.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                   break;
               case 'popular':
                   filtered.sort((a, b) => {
                       const aReactions = Object.values(a.reactions || {}).reduce((sum, val) => sum + val, 0);
                       const bReactions = Object.values(b.reactions || {}).reduce((sum, val) => sum + val, 0);
                       return bReactions - aReactions;
                   });
                   break;
               default:
                   filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
           }
           
           return filtered;
       }

       function createConfessionElement(confession) {
           const confessionElement = document.createElement('div');
           confessionElement.className = `confession-card ${confession.reported ? 'reported' : ''}`;
           confessionElement.setAttribute('data-id', confession.id);
           
           const categoryBadge = confession.category ? 
               `<span class="category-badge">${confession.category}</span>` : '';
           
           const anonIdentity = generateAnonIdentity(confession.userId);
           const anonBadge = `<span class="anon-badge"><i class="fas fa-user-secret"></i> ${anonIdentity}</span>`;
           
           const totalReactions = Object.values(confession.reactions || {}).reduce((sum, val) => sum + val, 0);
           
           const isDonor = userDonations.length > 0;
           const donorBadge = isDonor ? '<span class="donor-badge"><i class="fas fa-gem"></i> Donor</span>' : '';
           
           const isWhale = userDonations.some(d => d.amount > 100);
           const whaleBadge = isWhale ? 
               `<span class="donor-badge" style="background: linear-gradient(135deg, #00c6ff, #0072ff);"><i class="fas fa-whale"></i> Whale</span>` : '';

           const tipAmount = confession.tips || 0;
           const tipBadge = tipAmount > 0 ? `<span class="tip-badge" style="background: var(--success-color); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-left: 8px;">$${tipAmount} tipped</span>` : '';
           
           const walletBadge = confession.walletAddress ? 
               `<span class="wallet-badge" style="background: var(--crypto-color); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-left: 8px;">
                   <i class="fas fa-wallet"></i> ${confession.walletType} Tips
               </span>` : '';
           
           const globalBadge = confession.isGlobal ? 
               `<span class="global-badge">
                   <i class="fas fa-globe"></i> Global
               </span>` : '';
           
           const tipButtonText = confession.walletAddress ? 
               '<i class="fas fa-hand-holding-usd"></i> Tip Author' : 
               '<i class="fas fa-hand-holding-usd"></i> Tip';
           
           confessionElement.innerHTML = `
               <div class="confession-header">
                   ${categoryBadge} ${anonBadge} ${globalBadge}
               </div>
               <p class="confession-text">${confession.text}</p>
               ${confession.memeUrl ? `
                  <div class="confession-meme">
                     <img src="${confession.memeUrl}" alt="Confession meme" style="max-width: 100%; max-height: 300px; border-radius: 8px; margin: 10px 0;">
                  </div>` : ''
               }
               <div class="confession-footer">
                   <div class="confession-meta">
                       <span><i class="far fa-clock"></i> ${formatDate(new Date(confession.timestamp))}</span>
                       <span><i class="far fa-eye"></i> ${confession.views || 0} views</span>
                       ${donorBadge} ${whaleBadge} ${tipBadge} ${walletBadge}
                   </div>
                   <div class="confession-actions">
                       ${createReactionButtons(confession)}
                       <button class="tip-btn" onclick="tipConfession('${confession.id}')">
                           ${tipButtonText}
                       </button>
                       <button class="share-btn" onclick="openShareOptions(event, '${confession.id}')">
                           <i class="fas fa-share-alt"></i>
                       </button>
                       <div class="share-options" id="share-options-${confession.id}">
                           <button class="share-option-btn" onclick="shareToTwitter('${confession.id}')">
                               <i class="fab fa-twitter"></i> Twitter
                           </button>
                           <button class="share-option-btn" onclick="copyShareLink('${confession.id}')">
                               <i class="fas fa-link"></i> Copy Link
                           </button>
                           <button class="share-option-btn" onclick="createShareCard('${confession.id}')">
                               <i class="fas fa-image"></i> Create Card
                           </button>
                       </div>
                       <button class="report-button" onclick="reportConfession('${confession.id}')">
                           <i class="fas fa-flag"></i>
                       </button>
                   </div>
               </div>
               ${createRepliesSection(confession)}
               <button class="admin-action" onclick="deleteConfession('${confession.id}')">
                   <i class="fas fa-times"></i>
               </button>
           `;
           
           if (totalReactions >= 50 && confession.userId === userId && !userAchievements.includes('popular_confession')) {
               userAchievements.push('popular_confession');
               addKarma(ACHIEVEMENTS.popularConfession.karma, 'achievement');
               showAchievement(ACHIEVEMENTS.popularConfession);
           }
           
           return confessionElement;
       }

       function createReactionButtons(confession) {
           const reactions = [
               { name: 'like', icon: 'fas fa-thumbs-up' },
               { name: 'dislike', icon: 'fas fa-thumbs-down' },
               { name: 'love', icon: 'fas fa-heart' },
               { name: 'haha', icon: 'fas fa-laugh' },
               { name: 'wow', icon: 'fas fa-surprise' },
               { name: 'sad', icon: 'fas fa-sad-tear' }
           ];
           
           return reactions.map(reaction => {
               const count = confession.reactions ? (confession.reactions[reaction.name] || 0) : 0;
               return `<button class="reaction-btn ${reaction.name}" onclick="reactToConfession('${confession.id}', '${reaction.name}')">
                   <i class="${reaction.icon}"></i> <span class="reaction-count">${count}</span>
               </button>`;
           }).join('');
       }

       function createRepliesSection(confession) {
           const replies = confession.replies || [];
           const replyCount = replies.length;
           
           return `
               <div class="replies-section">
                   <button class="replies-toggle" onclick="toggleReplies('${confession.id}')">
                       <i class="fas fa-comments"></i>
                       Replies <span class="reply-count">(${replyCount})</span>
                   </button>
                   <div class="replies-container" id="replies-${confession.id}">
                       ${replies.map(reply => {
                           const replyAuthor = generateAnonIdentity(reply.userId);
                           return `
                           <div class="reply">
                               <p>${reply.text}</p>
                               <div class="reply-meta">
                                   <span class="reply-author">${replyAuthor}</span>
                                   <span class="reply-timestamp">${formatDate(new Date(reply.timestamp))}</span>
                               </div>
                           </div>
                       `}).join('')}
                       <div class="reply-form">
                           <textarea class="reply-input" placeholder="Write a reply..." id="reply-input-${confession.id}"></textarea>
                           <button class="reply-submit" onclick="submitReply('${confession.id}')">Reply</button>
                       </div>
                   </div>
               </div>
           `;
       }

       function formatDate(date) {
           try {
               const now = new Date();
               const diffMs = now - date;
               const diffSec = Math.floor(diffMs / 1000);
               const diffMin = Math.floor(diffSec / 60);
               const diffHour = Math.floor(diffMin / 60);
               const diffDay = Math.floor(diffHour / 24);
               
               if (diffSec < 60) {
                   return 'just now';
               } else if (diffMin < 60) {
                   return `${diffMin} minute${diffMin === 1 ? '' : 's'} ago`;
               } else if (diffHour < 24) {
                   return `${diffHour} hour${diffHour === 1 ? '' : 's'} ago`;
               } else {
                   return `${diffDay} day${diffDay === 1 ? '' : 's'} ago`;
               }
           } catch (error) {
               console.error("Error formatting date:", error);
               return "unknown time";
           }
       }

       // User Data Management
       function loadUserData() {
           const userData = localStorage.getItem('userData_' + userId);
           if (userData) {
               const data = JSON.parse(userData);
               userKarma = data.karma || 0;
               userAchievements = data.achievements || [];
           }
           updateKarmaDisplay();
       }

       function saveUserData() {
           const userData = {
               karma: userKarma,
               achievements: userAchievements,
               lastSubmissionDate: new Date().toDateString()
           };
           localStorage.setItem('userData_' + userId, JSON.stringify(userData));
           
           if (isGlobalMode && firebaseInitialized) {
               saveUserDataToFirebase(userData);
           }
       }

       function updateKarmaDisplay() {
           const karmaElement = document.getElementById('karma-count');
           if (karmaElement) {
               karmaElement.textContent = userKarma;
           }
       }

       function addKarma(points, reason) {
           userKarma += points;
           updateKarmaDisplay();
           saveUserData();
           checkAchievements();
       }

       function showAchievement(achievement) {
           const popup = document.getElementById('achievement-popup');
           if (popup) {
               document.getElementById('achievement-title').textContent = achievement.title;
               document.getElementById('achievement-description').textContent = achievement.description;
               
               popup.classList.add('show');
               
               setTimeout(() => {
                   popup.classList.remove('show');
               }, 5000);
           }
       }

       function checkAchievements() {
           const confessions = isGlobalMode ? [] : (JSON.parse(localStorage.getItem('confessions')) || []);
           const userConfessions = confessions.filter(c => c.userId === userId);
           
           if (userConfessions.length === 1 && !userAchievements.includes('first_confession')) {
               userAchievements.push('first_confession');
               addKarma(ACHIEVEMENTS.firstConfession.karma, 'achievement');
               showAchievement(ACHIEVEMENTS.firstConfession);
           }
           
           if (userKarma >= 1000 && !userAchievements.includes('karma_legend')) {
               userAchievements.push('karma_legend');
               addKarma(ACHIEVEMENTS.karmaLegend.karma, 'achievement');
               showAchievement(ACHIEVEMENTS.karmaLegend);
           }
           
           saveUserData();
       }

       function showSuccessMessage(message) {
           const successMessage = document.getElementById('success-message');
           if (successMessage) {
               successMessage.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
               successMessage.style.display = 'flex';
               
               setTimeout(() => {
                   successMessage.style.display = 'none';
               }, 3000);
           }
       }

       function showErrorMessage(message) {
           const errorMessage = document.getElementById('error-message');
           const errorText = document.getElementById('error-text');
           if (errorMessage && errorText) {
               errorText.textContent = message;
               errorMessage.style.display = 'flex';
               
               setTimeout(() => {
                   errorMessage.style.display = 'none';
               }, 3000);
           }
       }

       function loadDonationData() {
           const savedDonations = localStorage.getItem('donations');
           if (savedDonations) {
               donations = JSON.parse(savedDonations);
           }
           
           const savedUserDonations = localStorage.getItem('userDonations_' + userId);
           if (savedUserDonations) {
               userDonations = JSON.parse(savedUserDonations);
           }
       }

       function incrementViewCount(confessionId) {
           try {
               if (isGlobalMode && firebaseInitialized) {
                   incrementGlobalViewCount(confessionId);
               }
               
               incrementLocalViewCount(confessionId);
           } catch (error) {
               console.error("Error incrementing view count:", error);
           }
       }

       async function incrementGlobalViewCount(confessionId) {
           try {
               if (!window.firebaseServices) {
                   throw new Error('Firebase services not available');
               }
               
               const { db, doc, updateDoc, increment } = window.firebaseServices;
               
               const confessionRef = doc(db, FIREBASE_SETTINGS.collection, confessionId);
               
               await updateDoc(confessionRef, {
                   views: increment(1),
                   popularity: increment(0.1)
               });
               
               console.log(`View count incremented for confession ${confessionId} in Firebase`);
           } catch (error) {
               console.error("Error incrementing global view count:", error);
           }
       }

       function incrementLocalViewCount(confessionId) {
           let confessions = JSON.parse(localStorage.getItem('confessions')) || [];
           const confessionIndex = confessions.findIndex(c => c.id === confessionId);
           
           if (confessionIndex !== -1) {
               if (typeof confessions[confessionIndex].views !== 'number') {
                   confessions[confessionIndex].views = 0;
               }
               
               confessions[confessionIndex].views++;
               localStorage.setItem('confessions', JSON.stringify(confessions));
               return confessions[confessionIndex].views;
           }
           return 0;
       }

       // Event handlers
       function handleSearch(e) {
           searchQuery = e.target.value;
           currentPage = 1;
           
           if (isGlobalMode) {
               loadGlobalConfessions();
           } else {
               loadConfessions();
           }
       }

       function handleSortChange(e) {
           currentSort = e.target.value;
           currentPage = 1;
           
           if (isGlobalMode) {
               loadGlobalConfessions();
           } else {
               loadConfessions();
           }
       }

       function handleCategoryFilterChange(e) {
           currentCategory = e.target.value;
           currentPage = 1;
           
           if (isGlobalMode) {
               loadGlobalConfessions();
           } else {
               loadConfessions();
           }
       }

       // Placeholder functions for features not fully implemented in this demo
       function openDonationModal() {
           const modal = document.getElementById('donation-modal');
           if (modal) modal.style.display = 'block';
       }

       function closeDonationModal() {
           const modal = document.getElementById('donation-modal');
           if (modal) modal.style.display = 'none';
       }

       function tipConfession(confessionId) {
           currentTipConfessionId = confessionId;
           openDonationModal();
       }

       function openShareOptions(event, confessionId) {
           console.log('Opening share options for:', confessionId);
       }

       function shareToTwitter(confessionId) {
           console.log('Sharing to Twitter:', confessionId);
       }

       function copyShareLink(confessionId) {
           console.log('Copying share link:', confessionId);
       }

       function createShareCard(confessionId) {
           console.log('Creating share card:', confessionId);
       }

       function reportConfession(confessionId) {
           console.log('Reporting confession:', confessionId);
       }

       function deleteConfession(confessionId) {
           console.log('Deleting confession:', confessionId);
       }

       function toggleReplies(confessionId) {
           const repliesContainer = document.getElementById(`replies-${confessionId}`);
           if (repliesContainer) {
               repliesContainer.classList.toggle('active');
           }
       }

       function submitReply(confessionId) {
           console.log('Submitting reply for:', confessionId);
       }

       function reactToConfession(confessionId, reactionType) {
           console.log('Reacting to confession:', confessionId, reactionType);
       }

       function createPagination(totalPages) {
           const paginationContainer = document.getElementById('pagination');
           if (!paginationContainer) return;
           
           paginationContainer.innerHTML = '';
           
           if (totalPages <= 1) return;
           
           for (let i = 1; i <= totalPages; i++) {
               const pageBtn = document.createElement('button');
               pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
               pageBtn.textContent = i;
               pageBtn.onclick = () => changePage(i);
               paginationContainer.appendChild(pageBtn);
           }
       }

       function changePage(page) {
           currentPage = page;
           
           if (isGlobalMode) {
               loadGlobalConfessions();
           } else {
               loadConfessions();
           }
           
           window.scrollTo({ top: 0, behavior: 'smooth' });
       }

       // Initialize app
       document.addEventListener('DOMContentLoaded', function() {
           console.log("Initializing app...");
           
           // Initialize user ID
           userId = localStorage.getItem('userId');
           if (!userId) {
               userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
               localStorage.setItem('userId', userId);
           }

           // Load user data
           loadUserData();
           loadDonationData();
           
           // Theme management
           const savedTheme = localStorage.getItem('theme') || 'dark';
           document.documentElement.setAttribute('data-theme', savedTheme);
           const themeIcon = document.querySelector('#theme-toggle i');
           if (themeIcon) {
               themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
           }

           // Check if welcome modal should be shown
           const welcomeShown = localStorage.getItem('welcomeShown');
           if (welcomeShown) {
               const welcomeModal = document.getElementById('welcome-modal');
               if (welcomeModal) {
                   welcomeModal.classList.remove('active');
               }
           }

           // Always start in global mode by default
           isGlobalMode = true;
           localStorage.setItem('globalMode', 'true');

           // Start enhanced animations
           createFloatingBubbles();
           updateLiveActivity();

           // Animate counters
           document.querySelectorAll('.hero-stat-number').forEach(counter => {
               const target = parseInt(counter.getAttribute('data-target'));
               setTimeout(() => {
                   animateCounter(counter, target);
               }, 2000);
           });

           // Event listeners for enhanced UI
           const themeToggle = document.getElementById('theme-toggle');
           if (themeToggle) {
               themeToggle.addEventListener('click', toggleTheme);
           }
           
           // Category card interactions
           document.querySelectorAll('.category-card').forEach(card => {
               card.addEventListener('click', function() {
                   const category = this.getAttribute('data-category');
                   selectedCategory = category;
                   showConfessionForm();
                   showToast(`Selected ${category} category`, 'success');
               });
           });

           // Search and filter event listeners
           const searchInput = document.getElementById('search-input');
           if (searchInput) {
               searchInput.addEventListener('input', handleSearch);
           }

           const sortSelect = document.getElementById('sort-select');
           if (sortSelect) {
               sortSelect.addEventListener('change', handleSortChange);
           }

           const categoryFilter = document.getElementById('category-filter');
           if (categoryFilter) {
               categoryFilter.addEventListener('change', handleCategoryFilterChange);
           }

           // Load confessions with enhanced loading
           setTimeout(() => {
               if (isGlobalMode) {
                   loadGlobalConfessions();
               } else {
                   loadConfessions();
               }
           }, 3000);

           // Show demo confessions for immediate visual feedback
           showDemoConfessions();
       });

       function showDemoConfessions() {
           const container = document.getElementById('confessions-list');
           
           setTimeout(() => {
               container.innerHTML = `
                   <div class="confession-card">
                       <div class="confession-header">
                           <span class="category-badge">Alpha</span>
                           <span class="anon-badge"><i class="fas fa-user-secret"></i> BasedApe623</span>
                           <span class="global-badge"><i class="fas fa-globe"></i> Global</span>
                       </div>
                       <p class="confession-text">Finally made it! After months of diamond hands through the bear market, my portfolio is finally in the green. The key was patience and not panic selling during the dips.</p>
                       <div class="confession-footer">
                           <div class="confession-meta">
                               <span><i class="far fa-clock"></i> 2 hours ago</span>
                               <span><i class="far fa-eye"></i> 156 views</span>
                           </div>
                           <div class="confession-actions">
                               <button class="reaction-btn"><i class="fas fa-thumbs-up"></i> 24</button>
                               <button class="reaction-btn"><i class="fas fa-heart"></i> 12</button>
                               <button class="reaction-btn"><i class="fas fa-laugh"></i> 8</button>
                               <button class="tip-btn"><i class="fas fa-hand-holding-usd"></i> Tip</button>
                               <button class="share-btn"><i class="fas fa-share-alt"></i></button>
                           </div>
                       </div>
                   </div>
                   <div class="confession-card">
                       <div class="confession-header">
                           <span class="category-badge">Rekt</span>
                           <span class="anon-badge"><i class="fas fa-user-secret"></i> PaperHands420</span>
                           <span class="global-badge"><i class="fas fa-globe"></i> Global</span>
                       </div>
<p class="confession-text">I sold my entire bag right before the pump. Watched it 10x in the next week. I had diamond hands for months but folded at the worst possible time. This is my villain origin story.</p>
                       <div class="confession-footer">
                           <div class="confession-meta">
                               <span><i class="far fa-clock"></i> 4 hours ago</span>
                               <span><i class="far fa-eye"></i> 203 views</span>
                           </div>
                           <div class="confession-actions">
                               <button class="reaction-btn"><i class="fas fa-thumbs-up"></i> 45</button>
                               <button class="reaction-btn"><i class="fas fa-heart"></i> 23</button>
                               <button class="reaction-btn"><i class="fas fa-sad-tear"></i> 67</button>
                               <button class="tip-btn"><i class="fas fa-hand-holding-usd"></i> Tip</button>
                               <button class="share-btn"><i class="fas fa-share-alt"></i></button>
                           </div>
                       </div>
                   </div>
                   <div class="confession-card">
                       <div class="confession-header">
                           <span class="category-badge">Shill</span>
                           <span class="anon-badge"><i class="fas fa-user-secret"></i> CryptoWhale999</span>
                           <span class="global-badge"><i class="fas fa-globe"></i> Global</span>
                       </div>
                       <p class="confession-text">Found this gem at 2M mcap. Team is doxxed, working product, and partnerships with major exchanges coming. DYOR but this could be the next 100x. Not financial advice but I'm going all in.</p>
                       <div class="confession-footer">
                           <div class="confession-meta">
                               <span><i class="far fa-clock"></i> 6 hours ago</span>
                               <span><i class="far fa-eye"></i> 89 views</span>
                           </div>
                           <div class="confession-actions">
                               <button class="reaction-btn"><i class="fas fa-thumbs-up"></i> 12</button>
                               <button class="reaction-btn"><i class="fas fa-heart"></i> 8</button>
                               <button class="reaction-btn"><i class="fas fa-surprise"></i> 15</button>
                               <button class="tip-btn"><i class="fas fa-hand-holding-usd"></i> Tip</button>
                               <button class="share-btn"><i class="fas fa-share-alt"></i></button>
                           </div>
                       </div>
                   </div>
               `;
           }, 1500);
       }

       // Additional enhanced functions
       async function saveUserDataToFirebase(userData) {
           try {
               if (!window.firebaseServices) {
                   throw new Error('Firebase services not available');
               }
               
               const { db, doc, setDoc } = window.firebaseServices;
               
               const userRef = doc(db, FIREBASE_SETTINGS.userCollection, userId);
               
               await setDoc(userRef, {
                   ...userData,
                   lastSynced: new Date().toISOString()
               });
               
               console.log('User data saved to Firebase');
           } catch (error) {
               console.error("Error saving user data to Firebase:", error);
           }
       }

       // Enhanced confession form submission
       function handleConfessionSubmit(e) {
           e.preventDefault();
           
           if (isSubmitting) return;
           
           const confessionText = document.getElementById('confession-text').value.trim();
           const submitBtn = document.querySelector('.cta-primary[type="submit"]');
           
           if (!confessionText) {
               showErrorMessage('Please enter a confession');
               return;
           }
           
           if (containsForbiddenWords(confessionText)) {
               showErrorMessage('Your confession contains inappropriate content. Please revise and try again.');
               return;
           }
           
           isSubmitting = true;
           submitBtn.disabled = true;
           const originalText = submitBtn.innerHTML;
           submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
           
           setTimeout(() => {
               if (isGlobalMode) {
                   addGlobalConfession(confessionText, selectedCategory);
               } else {
                   addLocalConfession(confessionText, selectedCategory);
               }
               
               document.getElementById('confession-text').value = '';
               showSuccessMessage('Your confession has been submitted successfully!');
               
               addKarma(KARMA_POINTS.submitConfession, 'submission');
               
               isSubmitting = false;
               submitBtn.disabled = false;
               submitBtn.innerHTML = originalText;
               
               document.getElementById('confession-form').style.display = 'none';
               
               if (isGlobalMode) {
                   loadGlobalConfessions();
               } else {
                   loadConfessions();
               }
           }, 2000);
       }

       function containsForbiddenWords(text) {
           const lowerText = text.toLowerCase();
           return FORBIDDEN_WORDS.some(word => lowerText.includes(word));
       }

       async function addGlobalConfession(text, category = null) {
           try {
               console.log("Adding global confession...");
               if (!window.firebaseServices) {
                   throw new Error('Firebase services not available');
               }
               
               const { db, collection, addDoc, serverTimestamp } = window.firebaseServices;
               
               const confessionsRef = collection(db, FIREBASE_SETTINGS.collection);
               
               const confession = {
                   text: text,
                   category: category,
                   userId: userId,
                   timestamp: new Date().toISOString(),
                   views: 0,
                   reactions: {
                       like: 0,
                       dislike: 0,
                       love: 0,
                       haha: 0,
                       wow: 0,
                       sad: 0
                   },
                   replies: [],
                   reports: 0,
                   reported: false,
                   tips: 0,
                   donors: [],
                   serverTimestamp: serverTimestamp(),
                   popularity: 0,
                   isGlobal: true
               };
               
               const docRef = await addDoc(confessionsRef, confession);
               console.log('Confession added to Firebase with ID:', docRef.id);
               
               saveConfessionLocally({
                   ...confession,
                   id: docRef.id
               });
               
               checkAchievements();
               
               return true;
           } catch (error) {
               console.error("Error adding confession to Firebase:", error);
               showErrorMessage("Error sharing globally. The confession was saved locally.");
               
               addLocalConfession(text, category);
               return false;
           }
       }

       function saveConfessionLocally(confession) {
           let confessions = JSON.parse(localStorage.getItem('confessions')) || [];
           confessions.unshift(confession);
           localStorage.setItem('confessions', JSON.stringify(confessions));
       }

       function addLocalConfession(text, category = null) {
           try {
               const confession = {
                   id: 'conf_' + Date.now(),
                   userId: userId,
                   text: text,
                   category: category,
                   timestamp: new Date().toISOString(),
                   views: 0,
                   reactions: {
                       like: 0,
                       dislike: 0,
                       love: 0,
                       haha: 0,
                       wow: 0,
                       sad: 0
                   },
                   replies: [],
                   reports: 0,
                   reported: false,
                   tips: 0,
                   donors: [],
                   isGlobal: false
               };
               
               let confessions = JSON.parse(localStorage.getItem('confessions')) || [];
               confessions.unshift(confession);
               
               localStorage.setItem('confessions', JSON.stringify(confessions));
               
               loadConfessions();
               checkAchievements();
               
               return true;
           } catch (error) {
               console.error("Error adding confession:", error);
               showErrorMessage("There was an error saving your confession. Please try again.");
               return false;
           }
       }

       // Placeholder donation modal functions
       function selectDonationAmount(btn) {
           document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('selected'));
           btn.classList.add('selected');
           
           const amount = btn.dataset.amount;
           if (amount === 'custom') {
               document.getElementById('custom-amount-container').style.display = 'block';
               selectedDonationAmount = document.getElementById('custom-amount-input').value;
           } else {
               document.getElementById('custom-amount-container').style.display = 'none';
               selectedDonationAmount = amount;
           }
           
           updateDonateButton();
       }

       function selectPaymentMethod(method) {
           document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
           method.classList.add('selected');
           selectedPaymentMethod = method.dataset.method;
           
           const addressDiv = document.getElementById('donation-address');
           addressDiv.innerHTML = `
               <div style="font-weight: 600; margin-bottom: 8px;">Send payment to:</div>
               <div style="margin-bottom: 10px;">${DONATION_ADDRESSES[selectedPaymentMethod]}</div>
               <button class="copy-address-btn" onclick="copyAddress('${DONATION_ADDRESSES[selectedPaymentMethod]}')">
                   <i class="fas fa-copy"></i> Copy Address
               </button>
           `;
           addressDiv.style.display = 'block';
           
           updateDonateButton();
       }

       function updateDonateButton() {
           const submitBtn = document.getElementById('donate-submit-btn');
           if (selectedDonationAmount && selectedPaymentMethod && parseFloat(selectedDonationAmount) > 0) {
               submitBtn.disabled = false;
           } else {
               submitBtn.disabled = true;
           }
       }

       function copyAddress(address) {
           if (!address) {
               showErrorMessage('No address available');
               return;
           }
           
           navigator.clipboard.writeText(address).then(() => {
               showSuccessMessage('Address copied to clipboard!');
           }).catch(() => {
               const textArea = document.createElement('textarea');
               textArea.value = address;
               document.body.appendChild(textArea);
               textArea.select();
               try {
                   document.execCommand('copy');
                   showSuccessMessage('Address copied to clipboard!');
               } catch (err) {
                   prompt('Copy this address:', address);
               }
               document.body.removeChild(textArea);
           });
       }

       // Add event listeners for donation modal
       document.addEventListener('DOMContentLoaded', function() {
           // Donation event listeners
           document.querySelectorAll('.amount-btn').forEach(btn => {
               btn.addEventListener('click', function() {
                   selectDonationAmount(this);
               });
           });
           
           document.querySelectorAll('.payment-method').forEach(method => {
               method.addEventListener('click', function() {
                   selectPaymentMethod(this);
               });
           });
           
           const customAmountInput = document.getElementById('custom-amount-input');
           if (customAmountInput) {
               customAmountInput.addEventListener('input', function() {
                   selectedDonationAmount = this.value;
                   updateDonateButton();
               });
           }
           
           // Close modal when clicking outside
           document.getElementById('donation-modal').addEventListener('click', function(e) {
               if (e.target.className === 'donation-modal') {
                   closeDonationModal();
               }
           });
           
           // Close modal buttons
           document.querySelectorAll('.close').forEach(closeBtn => {
               closeBtn.addEventListener('click', function() {
                   const modal = this.closest('.modal, .donation-modal');
                   if (modal) {
                       if (modal.id === 'donation-modal') {
                           closeDonationModal();
                       } else {
                           modal.style.display = 'none';
                       }
                   }
               });
           });

           // Confession form submission
           const confessionForm = document.getElementById('confession-form');
           if (confessionForm) {
               confessionForm.addEventListener('submit', handleConfessionSubmit);
           }
       });

       // Additional CSS for enhanced styling
       const additionalStyles = `
           .confession-card {
               background: var(--glass-bg);
               backdrop-filter: blur(20px);
               border: 1px solid var(--glass-border);
               border-radius: 20px;
               padding: 25px;
               margin-bottom: 25px;
               transition: all 0.3s ease;
               border-left: 4px solid var(--primary-color);
           }

           .confession-card:hover {
               transform: translateY(-5px);
               box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
           }

           .confession-header {
               display: flex;
               align-items: center;
               gap: 10px;
               margin-bottom: 15px;
               flex-wrap: wrap;
           }

           .category-badge {
               background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
               color: white;
               padding: 4px 12px;
               border-radius: 15px;
               font-size: 0.8rem;
               font-weight: 600;
           }

           .anon-badge {
               background: var(--glass-bg);
               border: 1px solid var(--glass-border);
               color: var(--text-color);
               padding: 4px 12px;
               border-radius: 15px;
               font-size: 0.8rem;
               font-weight: 500;
           }

           .global-badge {
               background: linear-gradient(135deg, var(--success-color), #34d399);
               color: white;
               padding: 4px 12px;
               border-radius: 15px;
               font-size: 0.8rem;
               font-weight: 500;
               display: flex;
               align-items: center;
               gap: 5px;
           }

           .confession-text {
               color: var(--text-color);
               line-height: 1.6;
               margin-bottom: 20px;
               font-size: 1rem;
           }

           .confession-footer {
               display: flex;
               justify-content: space-between;
               align-items: center;
               padding-top: 15px;
               border-top: 1px solid var(--border-color);
               flex-wrap: wrap;
               gap: 15px;
           }

           .confession-meta {
               display: flex;
               gap: 20px;
               color: var(--text-light);
               font-size: 0.9rem;
           }

           .confession-actions {
               display: flex;
               gap: 10px;
           }

           .reaction-btn, .tip-btn, .share-btn {
               background: var(--glass-bg);
               border: 1px solid var(--glass-border);
               color: var(--text-color);
               padding: 8px 12px;
               border-radius: 20px;
               cursor: pointer;
               transition: all 0.3s ease;
               font-size: 0.9rem;
               display: flex;
               align-items: center;
               gap: 5px;
           }

           .reaction-btn:hover, .share-btn:hover {
               background: rgba(102, 126, 234, 0.1);
               border-color: var(--primary-color);
               transform: translateY(-1px);
           }

           .tip-btn {
               background: linear-gradient(135deg, var(--warning-color), #e6951e);
               color: white;
               border: none;
           }

           .tip-btn:hover {
               transform: translateY(-2px);
               box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
           }

           .no-confessions {
               text-align: center;
               color: var(--text-light);
               padding: 60px 20px;
               font-style: italic;
               background: var(--glass-bg);
               border-radius: 20px;
               backdrop-filter: blur(20px);
               border: 1px solid var(--glass-border);
           }

           .no-confessions i {
               display: block;
               font-size: 3rem;
               margin-bottom: 20px;
               color: var(--primary-light);
           }

           .loading {
               display: flex;
               justify-content: center;
               align-items: center;
               padding: 60px;
               color: var(--primary-color);
           }

           .loading i {
               font-size: 2rem;
               animation: spin 1s linear infinite;
           }

           @keyframes spin {
               0% { transform: rotate(0deg); }
               100% { transform: rotate(360deg); }
           }

           .page-btn {
               padding: 8px 15px;
               border: 1px solid var(--glass-border);
               background: var(--glass-bg);
               color: var(--text-color);
               border-radius: 8px;
               cursor: pointer;
               transition: all 0.3s ease;
               backdrop-filter: blur(20px);
           }

           .page-btn:hover {
               background: var(--primary-light);
               color: white;
               border-color: var(--primary-light);
           }

           .page-btn.active {
               background: var(--primary-color);
               color: white;
               border-color: var(--primary-color);
           }

           .modal {
               display: none;
               position: fixed;
               z-index: 1000;
               left: 0;
               top: 0;
               width: 100%;
               height: 100%;
               background-color: rgba(0,0,0,0.8);
               backdrop-filter: blur(10px);
           }

           .modal-content {
               background: var(--glass-bg);
               backdrop-filter: blur(20px);
               border: 1px solid var(--glass-border);
               margin: 5% auto;
               padding: 30px;
               border-radius: 20px;
               width: 90%;
               max-width: 600px;
               max-height: 80vh;
               overflow-y: auto;
               color: var(--text-color);
           }

           .donation-modal {
               display: none;
               position: fixed;
               z-index: 1001;
               left: 0;
               top: 0;
               width: 100%;
               height: 100%;
               background-color: rgba(0,0,0,0.8);
               backdrop-filter: blur(10px);
               animation: fadeIn 0.3s ease;
           }

           .donation-modal-content {
               background: var(--glass-bg);
               backdrop-filter: blur(20px);
               border: 1px solid var(--glass-border);
               margin: 5% auto;
               padding: 30px;
               border-radius: 20px;
               width: 90%;
               max-width: 500px;
               position: relative;
               animation: slideUp 0.3s ease;
               color: var(--text-color);
           }

           @keyframes slideUp {
               from { transform: translateY(50px); opacity: 0; }
               to { transform: translateY(0); opacity: 1; }
           }

           .donation-header {
               text-align: center;
               margin-bottom: 25px;
           }

           .donation-title {
               font-size: 1.5rem;
               font-weight: 700;
               color: var(--primary-color);
               margin-bottom: 10px;
           }

           .donation-subtitle {
               color: var(--text-light);
               font-size: 0.95rem;
           }

           .donation-amounts {
               display: grid;
               grid-template-columns: repeat(3, 1fr);
               gap: 10px;
               margin-bottom: 20px;
           }

           .amount-btn {
               background: var(--glass-bg);
               border: 2px solid var(--glass-border);
               padding: 12px;
               border-radius: 10px;
               cursor: pointer;
               text-align: center;
               transition: all 0.3s ease;
               font-weight: 600;
               color: var(--text-color);
               backdrop-filter: blur(20px);
           }

           .amount-btn:hover {
               border-color: var(--primary-color);
               transform: translateY(-2px);
           }

           .amount-btn.selected {
               border-color: var(--primary-color);
               background: rgba(108, 92, 231, 0.1);
               color: var(--primary-color);
           }

           .payment-options {
               margin-bottom: 20px;
           }

           .payment-method {
               display: flex;
               align-items: center;
               padding: 15px;
               border: 2px solid var(--glass-border);
               border-radius: 10px;
               margin-bottom: 10px;
               cursor: pointer;
               transition: all 0.3s ease;
               background: var(--glass-bg);
               backdrop-filter: blur(20px);
           }

           .payment-method:hover {
               border-color: var(--primary-color);
           }

           .payment-method.selected {
               border-color: var(--primary-color);
               background: rgba(108, 92, 231, 0.1);
           }

           .payment-method i {
               font-size: 1.5rem;
               margin-right: 15px;
               color: var(--crypto-color);
           }

           .payment-info {
               flex: 1;
           }

           .payment-name {
               font-weight: 600;
               color: var(--text-color);
           }

           .payment-desc {
               font-size: 0.85rem;
               color: var(--text-light);
           }

           .close {
               color: var(--text-light);
               float: right;
               font-size: 28px;
               font-weight: bold;
               cursor: pointer;
           }

           .close:hover {
               color: var(--text-color);
           }

           @media (max-width: 768px) {
               .confession-footer {
                   flex-direction: column;
                   align-items: flex-start;
               }
               
               .confession-actions {
                   width: 100%;
                   justify-content: space-between;
               }

               .donation-amounts {
                   grid-template-columns: repeat(2, 1fr);
               }
           }
       `;

       // Inject additional styles
       const styleSheet = document.createElement('style');
       styleSheet.textContent = additionalStyles;
       document.head.appendChild(styleSheet);

   </script>

   <!-- Additional styles for connection status and achievement popup -->
   <style>
       .connection-status {
           position: fixed;
           bottom: 20px;
           right: 20px;
           z-index: 1000;
           padding: 8px 12px;
           border-radius: 20px;
           font-size: 0.8rem;
           display: flex;
           align-items: center;
           gap: 8px;
           box-shadow: 0 2px 10px rgba(0,0,0,0.2);
           animation: fadeIn 0.5s ease-out;
           backdrop-filter: blur(20px);
       }

       .status-online {
           background-color: var(--success-color);
           color: white;
       }

       .status-offline {
           background-color: var(--danger-color);
           color: white;
       }

       .status-connecting {
           background-color: var(--warning-color);
           color: #333;
       }

       .achievement-popup {
           position: fixed;
           top: 20px;
           right: 20px;
           background: var(--success-color);
           color: white;
           padding: 15px 20px;
           border-radius: 8px;
           box-shadow: 0 4px 12px rgba(0,0,0,0.15);
           display: none;
           animation: slideIn 0.3s ease-out;
           z-index: 1000;
           backdrop-filter: blur(20px);
       }

       .achievement-popup.show {
           display: block;
       }

       .achievement-popup h4 {
           margin: 0 0 5px 0;
           font-size: 1rem;
       }

       .achievement-popup p {
           margin: 0;
           font-size: 0.85rem;
           opacity: 0.9;
       }

       .share-options {
           display: none;
           position: absolute;
           background: var(--glass-bg);
           backdrop-filter: blur(20px);
           border: 1px solid var(--glass-border);
           border-radius: 8px;
           padding: 10px;
           z-index: 100;
           box-shadow: 0 4px 12px rgba(0,0,0,0.15);
           right: 0;
           top: 100%;
           margin-top: 5px;
           min-width: 150px;
       }

       .share-options.active {
           display: block;
       }

       .share-option-btn {
           display: block;
           width: 100%;
           text-align: left;
           padding: 8px 12px;
           border: none;
           background: none;
           cursor: pointer;
           color: var(--text-color);
           font-size: 0.9rem;
           border-radius: 4px;
           transition: background 0.2s ease;
       }

       .share-option-btn:hover {
           background: rgba(102, 126, 234, 0.1);
       }

       .share-option-btn i {
           margin-right: 8px;
           width: 16px;
           text-align: center;
       }

       .replies-section {
           margin-top: 20px;
           border-top: 1px solid var(--border-color);
           padding-top: 15px;
       }

       .replies-toggle {
           background: none;
           border: none;
           color: var(--primary-color);
           cursor: pointer;
           font-size: 0.9rem;
           padding: 5px 10px;
           display: flex;
           align-items: center;
           gap: 5px;
           border-radius: 5px;
           transition: background 0.2s ease;
       }

       .replies-toggle:hover {
           background: rgba(102, 126, 234, 0.1);
       }

       .replies-container {
           margin-top: 15px;
           display: none;
       }

       .replies-container.active {
           display: block;
       }

       .reply {
           background: rgba(102, 126, 234, 0.05);
           border-left: 3px solid var(--primary-light);
           padding: 10px 15px;
           margin: 10px 0;
           border-radius: 0 8px 8px 0;
       }

       .reply-meta {
           margin-top: 8px;
           font-size: 0.8rem;
           color: var(--text-light);
           display: flex;
           gap: 10px;
       }

       .reply-form {
           margin-top: 15px;
           display: flex;
           gap: 10px;
       }

       .reply-input {
           flex: 1;
           padding: 8px 12px;
           border: 1px solid var(--glass-border);
           border-radius: 8px;
           font-family: inherit;
           resize: none;
           background: var(--glass-bg);
           color: var(--text-color);
           backdrop-filter: blur(20px);
       }

       .reply-submit {
           padding: 8px 16px;
           background: var(--primary-color);
           color: white;
           border: none;
           border-radius: 8px;
           cursor: pointer;
           font-weight: 500;
           transition: background 0.2s ease;
       }

       .reply-submit:hover {
           background: var(--primary-dark);
       }

       .admin-action {
           display: none;
           position: absolute;
           top: 10px;
           right: 10px;
           background-color: #e74c3c;
           color: white;
           border: none;
           width: 30px;
           height: 30px;
           border-radius: 50%;
           cursor: pointer;
           font-size: 0.8rem;
           transition: background-color 0.3s ease;
           align-items: center;
           justify-content: center;
       }

       .admin-mode .admin-action {
           display: flex;
       }

       .admin-action:hover {
           background-color: #c0392b;
       }
   </style>
</body>
</html>
